<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Sentimen dengan C5.0</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <style>
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
        }
        .token-box {
            background-color: #e3f2fd;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .token {
            display: inline-block;
            background: #bbdefb;
            padding: 3px 8px;
            margin: 2px;
            border-radius: 3px;
        }
        .feature-box {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .tree-visualization {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }
        .sentiment-badge {
            font-size: 1.2em;
            padding: 8px 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-5 mb-5">
        <h1 class="mb-4">Analisis Sentimen dengan Pohon Keputusan</h1>
        
        <!-- Training Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Model Training</h3>
            </div>
            <div class="card-body">
                <button id="trainButton" class="btn btn-primary mb-3">Latih Model</button>
                <div id="trainingResult" style="display: none;">
                    <div class="alert alert-success">Model berhasil dilatih!</div>
                    <h4>Visualisasi Pohon Keputusan:</h4>
                    <div class="text-center">
                        <img id="treeVisualization" class="tree-visualization" alt="Decision Tree">
                    </div>
                    <h4 class="mt-4">Rules yang Dihasilkan:</h4>
                    <pre id="modelRules"></pre>
                </div>
            </div>
        </div>

        <!-- Analysis Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h3>Analisis Sentimen</h3>
            </div>
            <div class="card-body">
                <form id="analysisForm">
                    <div class="form-group">
                        <label>Masukkan Komentar:</label>
                        <textarea class="form-control" name="comment" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label>Jumlah Like:</label>
                            <input type="number" class="form-control" name="likes" value="0" min="0">
                        </div>
                        <div class="form-group col-md-6">
                            <label>Jumlah Dislike:</label>
                            <input type="number" class="form-control" name="dislikes" value="0" min="0">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Analisis Sentimen</button>
                </form>
            </div>
        </div>

        <!-- Analysis Results -->
        <div id="analysisResult" style="display: none;">
            <h2 class="mb-4">Hasil Analisis</h2>

            <!-- Tokenization -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>1. Hasil Tokenisasi</h4>
                </div>
                <div class="card-body">
                    <div class="token-box" id="tokens"></div>
                </div>
            </div>

            <!-- Features -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>2. Fitur yang Diekstrak</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="feature-box">
                                <h5>Fitur Teks:</h5>
                                <ul class="list-unstyled" id="textFeatures"></ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-box">
                                <h5>Fitur Sentimen:</h5>
                                <ul class="list-unstyled" id="sentimentFeatures"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matching Rules -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>3. Rules yang Cocok</h4>
                </div>
                <div class="card-body">
                    <div id="matchingRules"></div>
                </div>
            </div>

            <!-- Final Prediction -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>4. Hasil Akhir</h4>
                </div>
                <div class="card-body text-center">
                    <h5>Skor Sentimen: <span id="sentimentScore"></span></h5>
                    <div id="prediction" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function formatNumber(num) {
            return Number(num).toFixed(3);
        }

        // Handle model training
        $('#trainButton').on('click', function() {
            $(this).prop('disabled', true).text('Melatih Model...');
            
            $.ajax({
                url: '/api/train',
                method: 'POST',
                contentType: 'application/json',
                success: function(response) {
                    $('#trainingResult').show();
                    $('#treeVisualization').attr('src', 'data:image/png;base64,' + response.tree_visualization);
                    $('#modelRules').text(JSON.stringify(response.rules, null, 2));
                    $('#trainButton').prop('disabled', false).text('Latih Model');
                },
                error: function(error) {
                    alert('Error: ' + (error.responseJSON?.error || 'Terjadi kesalahan'));
                    $('#trainButton').prop('disabled', false).text('Latih Model');
                }
            });
        });

        // Handle sentiment analysis
        $('#analysisForm').on('submit', function(e) {
            e.preventDefault();
            const formData = {
                comment: $('textarea[name="comment"]').val(),
                likes: parseInt($('input[name="likes"]').val()) || 0,
                dislikes: parseInt($('input[name="dislikes"]').val()) || 0
            };

            $.ajax({
                url: '/api/analyze',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    $('#analysisResult').show();

                    // Display tokens
                    $('#tokens').html(
                        response.tokens.map(token => 
                            `<span class="token">${token}</span>`
                        ).join(' ')
                    );

                    // Display text features
                    $('#textFeatures').html(`
                        <li>Jumlah Token: ${response.features.jumlah_token}</li>
                        <li>Jumlah Tanda Seru: ${response.features.jumlah_tanda_seru}</li>
                        <li>Jumlah Tanda Tanya: ${response.features.jumlah_tanda_tanya}</li>
                    `);

                    // Display sentiment features
                    $('#sentimentFeatures').html(`
                        <li>Skor Positif: ${formatNumber(response.features.skor_positif)}</li>
                        <li>Skor Negatif: ${formatNumber(response.features.skor_negatif)}</li>
                        <li>Skor Likes: ${formatNumber(response.features.skor_likes)}</li>
                        <li>Skor Dislikes: ${formatNumber(response.features.skor_dislikes)}</li>
                    `);

                    // Display matching rules
                    const rulesList = response.matching_rules
                        .map(rule => `
                            <div class="feature-box">
                                <h5>Range Skor: ${formatNumber(rule.score_range[0])} hingga ${formatNumber(rule.score_range[1])}</h5>
                                <p>Sentimen yang Diprediksi: ${rule.predicted_sentiment}</p>
                                <p>Sentimen Aktual: ${rule.actual_sentiment}</p>
                            </div>
                        `).join('');
                    $('#matchingRules').html(rulesList || '<div>Tidak ada aturan yang cocok</div>');

                    // Display final prediction
                    $('#sentimentScore').text(formatNumber(response.score));
                    $('#prediction').html(`
                        <span class="badge badge-${
                            response.sentiment === 'positive' ? 'success' :
                            response.sentiment === 'negative' ? 'danger' : 'warning'
                        } sentiment-badge">
                            ${response.sentiment.toUpperCase()}
                        </span>
                    `);
                },
                error: function(error) {
                    alert('Error: ' + (error.responseJSON?.error || 'Terjadi kesalahan'));
                }
            });
        });
    </script>
</body>
</html>